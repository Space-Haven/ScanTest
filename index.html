<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="-1">
    <title>Scan & Submit</title>
    <script src="https://unpkg.com/onscan.js/onscan.min.js"></script>
</head>
<body>

    <h1>Space Haven - Scan Test</h1>
    <h3>Version 1.1.7</h3>
    <form id="scan-form" action="https://space-haven.github.io/ScanTest/" method="POST">
        <label for="barcode">Scanned Code:</label>
        <input type="text" id="barcode" name="barcode" data-rt-scan="code" required>
        <button type="submit">Submit</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
	    var thisRoute = window.location.pathname;
	    console.log("ROUTE: " + thisRoute);
		
            onScan.attachTo(document, {
                onScan: function (scannedData) {
			
		    var jsonPayload = JSON.parse(scannedData);
                    console.log(jsonPayload);
		    var scanBarcode = jsonPayload.code;
		    var scanType = jsonPayload.type;

		    console.log("BARCODE: " + scanBarcode);
		    console.log("TYPE: " + scanType);

		    let inputField = document.getElementById("scanBarcode");
                    inputField.value = scanBarcode;

		    switch(scanType) {
  			case "product":
    				console.log("You Scanned Product " + scanBarCode);
    			break;
  			case "location":
    				console.log("You Scanned Location " + scanBarCode);
    			break;
		        case "dockDoor":
    				console.log("You Scanned Dock Door " + scanBarCode);
    			break;
  			default:
    				// code block
			}
			
                    // Auto-submit the form
                    //document.getElementById("scan-form").submit();
		    //alert(document.getElementById('barcode').value);
                },
                onScanError: function (error) {
                    console.error("Scan error:", error);
                },
                minLength: 3,  // Minimum barcode length
                reactToKeydown: true, // No Keydown Events
		reactToPaste: true, // ReactToPasted Content As Well As Scan
                timeBeforeScanTest: 200,  // Time before considering input as barcode
                keyCodeReducer: function (keyCode) {
                    return String.fromCharCode(keyCode); // Converts keyCode to character
                }
            });
        });
    </script>
	
</body>
</html>
